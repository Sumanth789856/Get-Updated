{% extends "layout.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">

<div class="profile-container">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="profile-header">
        <div class="profile-image-container">
            <img src="{{ url_for('static', filename='profile_images/' + (user_data.profile_image or 'default.png')) }}" 
                 alt="Profile Picture" class="profile-image">

            <form action="{{ url_for('upload_profile_picture') }}" method="POST" enctype="multipart/form-data" id="profile-pic-form">
                <label for="profile_picture" class="profile-image-upload">
                    <i class="fas fa-camera"></i>
                </label>
                <input type="file" id="profile_picture" name="profile_picture" style="display: none;" accept="image/*" onchange="this.form.submit()">
            </form>
        </div>

        <div class="role-badge role-{{ user_data.role|lower }}">
            {{ user_data.role|upper }}
        </div>
    </div>

    <form class="profile-form" method="POST" action="{{ url_for('profile') }}">
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" value="{{ user_data.username }}" required>
        </div>

        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="{{ user_data.email }}" required>
        </div>

        <div class="form-group">
            <label for="gender">Gender</label>
            <select id="gender" name="gender" required>
                <option value="male" {% if user_data.gender == 'male' %}selected{% endif %}>Male</option>
                <option value="female" {% if user_data.gender == 'female' %}selected{% endif %}>Female</option>
                <option value="other" {% if user_data.gender == 'other' %}selected{% endif %}>Other</option>
            </select>
        </div>

        <div class="form-group">
            <label for="role">Role</label>
            <input type="text" id="role" value="{{ user_data.role }}" disabled>
        </div>

        <div class="password-change-section">
            <h3>Change Password</h3>
            <div class="form-group">
                <label for="current_password">Current Password</label>
                <input type="password" id="current_password" name="current_password" 
                       placeholder="Enter your current password">
            </div>

            <div class="form-group">
                <label for="new_password">New Password</label>
                <input type="password" id="new_password" name="new_password" minlength="8" 
                       pattern=".{8,}" 
                       title="Password must be at least 8 characters long"
                       placeholder="Enter new password">
            </div>

            <div class="form-group">
                <label for="confirm_password">Confirm New Password</label>
                <input type="password" id="confirm_password" name="confirm_password" minlength="6"
                       placeholder="Confirm new password">
            </div>

            <div class="form-group small text-muted">
                <strong>Password Requirements:</strong>
                <ul>
                    <li>At least 8 characters long</li>
                </ul>
            </div>
        </div>

        <div class="profile-actions">
            <button type="submit" class="btn-save">Save Changes</button>
            <a href="{{ url_for('dashboard') }}" class="btn-cancel">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}
